<div class="max-w-4xl mx-auto p-6">
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h1 class="text-2xl font-semibold mb-4">
      Добро пожаловать<% if @user.shop.present? %>, <%= @user.shop %><% end %>!
    </h1>

    <div class="space-y-4">
      <div>
        <h2 class="text-lg font-medium text-gray-700 mb-2">Статус оплаты</h2>
        <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
          <% case @user.charge_status
             when "active"
               if @user.blocked
                 %>bg-red-100 text-red-800<% # Заблокирована
               else
                 %>bg-green-100 text-green-800<% # Активна
               end
             when "pending"
               %>bg-yellow-100 text-yellow-800<% # Ожидает подтверждения
             when "declined", "cancelled"
               %>bg-gray-100 text-gray-800<% # Неактивна
             else
               %>bg-gray-100 text-gray-800<% # Не оформлена
             end %>">
          <% case @user.charge_status
             when "active"
               if @user.blocked
                 %>Заблокирована<%
               else
                 %>Активна<%
               end
             when "pending"
               %>Ожидает подтверждения<%
             when "declined", "cancelled"
               %>Неактивна<%
             else
               %>Не оформлена<%
             end %>
        </div>
      </div>

      <div>
        <h2 class="text-lg font-medium text-gray-700 mb-2">Период действия</h2>
        <p class="text-gray-600">
          <% if @user.charge_status == "active" && @user.paid_till.present? %>
            Оплачено до: <strong><%= @user.paid_till.strftime("%d.%m.%Y") %></strong>
          <% elsif @user.charge_status == "pending" && @user.trial_ends_at.present? %>
            Триал до: <strong><%= @user.trial_ends_at.strftime("%d.%m.%Y") %></strong>
          <% elsif @user.charge_status == "declined" || @user.charge_status == "cancelled" %>
            Подписка неактивна
          <% else %>
            Подписка не оформлена
          <% end %>
        </p>
      </div>

      <div class="pt-4 flex flex-row items-center space-x-3">
        <% if @user.mark_installed? %>
          <%= link_to "Настройки приложения", mark_login_path, 
                class: "inline-flex items-center px-4 py-2 rounded-md text-white bg-blue-600 hover:bg-blue-700",
                data: { turbo: false } %>
        <% else %>
          <%= link_to "Настройки приложения", "#", 
                class: "inline-flex items-center px-4 py-2 rounded-md text-white bg-blue-600 hover:bg-blue-700" %>
        <% end %>
        <%= link_to "Вернуться в магазин", "https://#{@user.shop}/admin", 
              class: "inline-flex items-center px-4 py-2 rounded-md text-gray-800 bg-gray-200 hover:bg-gray-300" %>
      </div>
    </div>
  </div>

  <%= render "shared/flash" %>
</div>

